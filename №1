/*
 * –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1
 * –¢–µ–º–∞: –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á (To-Do List)
 * –°—Ç—É–¥–µ–Ω—Ç: –ü–∞–Ω—Ç–µ–ª–µ–µ–≤ –ê–¥—Ä–∏–∞–Ω –î–µ–Ω–∏—Å–æ–≤–∏—á
 * –ì—Ä—É–ø–ø–∞: 24–ö–ù–¢-1
 * –ë–∏–ª–µ—Ç: 1

 * –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é:
 * - —Å–æ–∑–¥–∞–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á,
 * - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞,
 * - —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è,
 * - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á,
 * - —É–¥–æ–±–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–º–∞–π–ª–∏–∫–∏ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –º–µ–Ω—é.
 */

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.*;

public class ToDoConsoleApp {
    private static final Scanner scanner = new Scanner(System.in);
    private static final DateTimeFormatter DATE_FMT = DateTimeFormatter.ofPattern("yyyy-MM-dd");
    private final List<Task> tasks = new ArrayList<>(); // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á

    public static void main(String[] args) {
        new ToDoConsoleApp().launch(); // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ–Ω—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    public void launch() {
        Map<String, Runnable> actions = Map.of(
            "1", this::addTask,
            "2", this::editTask,
            "3", this::deleteTask,
            "4", this::changePriority,
            "5", this::setDueDate,
            "6", this::listTasks,
            "7", this::sortByDate,
            "8", this::searchTasks
        );

        boolean running = true;
        while (running) {
            printMenu();
            String choice = scanner.nextLine().trim();
            if (choice.equals("0")) break;
            // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –≤—ã–≤–æ–¥ –æ—à–∏–±–∫–∏
            actions.getOrDefault(choice, () -> System.out.println("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.")).run();
        }
        System.out.println("üëã –í—ã—Ö–æ–¥. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!");
    }

    // –ü–µ—á–∞—Ç—å –º–µ–Ω—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–º–∞–π–ª–∏–∫–æ–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
    private void printMenu() {
        System.out.println("\nüìã –ú–µ–Ω—é –∑–∞–¥–∞—á:");
        System.out.println("1Ô∏è‚É£ - –°–æ–∑–¥–∞—Ç—å");
        System.out.println("2Ô∏è‚É£ - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å");
        System.out.println("3Ô∏è‚É£ - –£–¥–∞–ª–∏—Ç—å");
        System.out.println("4Ô∏è‚É£ - –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç");
        System.out.println("5Ô∏è‚É£ - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫");
        System.out.println("6Ô∏è‚É£ - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏");
        System.out.println("7Ô∏è‚É£ - –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ");
        System.out.println("8Ô∏è‚É£ - –ü–æ–∏—Å–∫");
        System.out.println("0Ô∏è‚É£ - –í—ã–π—Ç–∏");
        System.out.print("–í—ã–±–æ—Ä: ");
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
    private void addTask() {
        String title = readInput("üìù –ù–∞–∑–≤–∞–Ω–∏–µ: ", "(–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)");
        String desc = readInput("‚úèÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ: ", "");
        Priority pr = readPriority("‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (LOW, MEDIUM, HIGH) [MEDIUM]: ", Priority.MEDIUM);
        LocalDate due = readDate("üìÖ –°—Ä–æ–∫ (yyyy-MM-dd) –∏–ª–∏ –ø—É—Å—Ç–æ: ");
        tasks.add(new Task(title, desc, due, pr));
        System.out.println("‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞.");
    }

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏ –ø–æ ID
    private void editTask() {
        Task t = selectTask();
        if (t == null) return;
        String title = readInput("üìù –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (Enter —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å): ", null);
        if (title != null) t.title = title;
        String desc = readInput("‚úèÔ∏è –ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (Enter —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å): ", null);
        if (desc != null) t.description = desc;
        System.out.println("‚úÖ –ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.");
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ ID
    private void deleteTask() {
        Task t = selectTask();
        if (t != null) {
            System.out.print("‚ùå –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ (y/N): ");
            if (scanner.nextLine().trim().equalsIgnoreCase("y")) {
                tasks.remove(t);
                System.out.println("üóëÔ∏è –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞.");
            }
        }
    }

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∑–∞–¥–∞—á–∏
    private void changePriority() {
        Task t = selectTask();
        if (t != null) {
            Priority pr = readPriority("‚ö° –ù–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ", null);
            if (pr != null) t.priority = pr;
        }
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
    private void setDueDate() {
        Task t = selectTask();
        if (t != null) t.dueDate = readDate("üìÖ –ù–æ–≤—ã–π —Å—Ä–æ–∫ (Enter —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å): ");
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á
    private void listTasks() {
        if (tasks.isEmpty()) { System.out.println("üì≠ –ù–µ—Ç –∑–∞–¥–∞—á."); return; }
        tasks.forEach(System.out::println);
    }

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á –ø–æ –¥–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    private void sortByDate() {
        tasks.sort(Comparator.comparing(t -> t.dueDate, Comparator.nullsLast(Comparator.naturalOrder())));
        listTasks();
    }

    // –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    private void searchTasks() {
        System.out.print("üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é: ");
        String q = scanner.nextLine().trim().toLowerCase();
        tasks.stream().filter(t -> t.title.toLowerCase().contains(q)).forEach(System.out::println);
    }

    // –í—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ –ø–æ ID
    private Task selectTask() {
        listTasks();
        System.out.print("üÜî –í–≤–µ–¥–∏—Ç–µ ID –∑–∞–¥–∞—á–∏: ");
        try { int id = Integer.parseInt(scanner.nextLine());
            return tasks.stream().filter(t -> t.id == id).findFirst().orElse(null);
        } catch (NumberFormatException e) { return null; }
    }

    // –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    private String readInput(String prompt, String defaultVal) {
        System.out.print(prompt);
        String s = scanner.nextLine().trim();
        return s.isEmpty() ? defaultVal : s;
    }

    // –ß—Ç–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∑–∞–¥–∞—á–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    private Priority readPriority(String prompt, Priority defaultVal) {
        System.out.print(prompt);
        String s = scanner.nextLine().trim().toUpperCase();
        if (s.isEmpty()) return defaultVal;
        try { return Priority.valueOf(s); } catch (Exception e) { return defaultVal; }
    }

    // –ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞
    private LocalDate readDate(String prompt) {
        System.out.print(prompt);
        String s = scanner.nextLine().trim();
        if (s.isEmpty()) return null;
        try { return LocalDate.parse(s, DATE_FMT); } catch (Exception e) { return null; }
    }

    // –ö–ª–∞—Å—Å Task –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID, –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –æ–ø–∏—Å–∞–Ω–∏–µ–º, —Å—Ä–æ–∫–æ–º –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
    private static class Task {
        private static int NEXT_ID = 1;
        int id = NEXT_ID++;
        String title, description;
        LocalDate dueDate;
        Priority priority;

        Task(String title, String description, LocalDate dueDate, Priority priority) {
            this.title = title; this.description = description;
            this.dueDate = dueDate; this.priority = priority;
        }

        @Override
        public String toString() {
            return String.format("ID=%d | %s | pri=%s | due=%s\n    %s",
                id, title, priority, dueDate == null ? "-" : dueDate.format(DATE_FMT), description);
        }
    }

    // –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∑–∞–¥–∞—á–∏
    private enum Priority { LOW, MEDIUM, HIGH }
}

